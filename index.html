<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Estaciona+ • Debug</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">
  <div class="max-w-md mx-auto bg-white rounded-xl shadow-md p-6">
    <h1 class="text-2xl font-bold text-center mb-6">🔧 Debug Estaciona+</h1>
    
    <!-- Resultados em TEMPO REAL -->
    <div id="resultados" class="mb-6 p-4 bg-yellow-50 rounded-lg">
      <h3 class="font-semibold mb-2">📊 Resultados dos Testes:</h3>
      <div id="logs" class="text-sm space-y-1 max-h-40 overflow-y-auto"></div>
    </div>

    <!-- Botões de Teste -->
    <div class="grid gap-3 mb-6">
      <button onclick="testarGET()" class="bg-blue-500 text-white p-3 rounded-lg font-semibold">
        🔍 Testar GET (Buscar Dados)
      </button>
      
      <button onclick="testarPOST()" class="bg-green-500 text-white p-3 rounded-lg font-semibold">
        📤 Testar POST (Enviar Dados)
      </button>
      
      <button onclick="limparLogs()" class="bg-gray-500 text-white p-3 rounded-lg">
        🗑️ Limpar Logs
      </button>
    </div>

    <!-- Formulário Simples -->
    <div class="bg-gray-50 p-4 rounded-lg">
      <h3 class="font-semibold mb-3">🚗 Testar com Veículo Real</h3>
      <button onclick="testarComVeiculoReal()" class="bg-purple-500 text-white p-3 rounded-lg w-full">
        ➕ Adicionar Veículo Teste
      </button>
    </div>
  </div>

  <script>
    const API_URL = 'https://estacionamento2.up.railway.app/api/veiculos';
    let logs = [];

    function addLog(mensagem, tipo = 'info') {
      const cores = {
        info: 'text-blue-600',
        success: 'text-green-600', 
        error: 'text-red-600',
        warning: 'text-orange-600'
      };
      
      const timestamp = new Date().toLocaleTimeString();
      logs.push(`<div class="${cores[tipo]}">${timestamp} - ${mensagem}</div>`);
      
      // Manter apenas últimos 20 logs
      if (logs.length > 20) logs = logs.slice(-20);
      
      document.getElementById('logs').innerHTML = logs.join('');
    }

    function limparLogs() {
      logs = [];
      document.getElementById('logs').innerHTML = '';
      addLog('Logs limpos!', 'info');
    }

    // TESTAR GET - Buscar dados
    async function testarGET() {
      addLog('🔍 Iniciando teste GET...', 'info');
      
      try {
        addLog('📡 Conectando com backend...', 'info');
        const response = await fetch(API_URL);
        
        addLog(`📊 Status: ${response.status} ${response.statusText}`, 
               response.ok ? 'success' : 'error');
        
        if (response.ok) {
          const data = await response.json();
          addLog(`✅ SUCESSO! Backend retornou: ${data.length} veículos`, 'success');
          
          if (data.length > 0) {
            addLog(`📋 Primeiro veículo: ${data[0].placa} - R$ ${data[0].valor}`, 'info');
          }
        } else {
          const erro = await response.text();
          addLog(`❌ ERRO: ${erro}`, 'error');
        }
      } catch (error) {
        addLog(`💥 ERRO GRAVE: ${error.message}`, 'error');
      }
    }

    // TESTAR POST - Enviar dados  
    async function testarPOST() {
      addLog('📤 Iniciando teste POST...', 'info');
      
      const veiculoTeste = {
        placa: "TEST-" + Math.random().toString(36).substr(2, 4).toUpperCase(),
        tipo: "carro",
        valor: 15.75,
        formaPagamento: "pix",
        pago: true,
        entrada: new Date().toISOString()
      };
      
      addLog(`📦 Enviando: ${veiculoTeste.placa} - R$ ${veiculoTeste.valor}`, 'info');
      
      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(veiculoTeste)
        });
        
        addLog(`📨 Status: ${response.status} ${response.statusText}`,
               response.ok ? 'success' : 'error');
        
        if (response.ok) {
          const data = await response.json();
          addLog(`✅ SUCESSO! Veículo criado com ID: ${data.id || 'sem ID'}`, 'success');
        } else {
          const erro = await response.text();
          addLog(`❌ ERRO: ${erro}`, 'error');
        }
      } catch (error) {
        addLog(`💥 ERRO GRAVE: ${error.message}`, 'error');
      }
    }

    // TESTAR COM VEÍCULO REAL
    async function testarComVeiculoReal() {
      addLog('🚗 Adicionando veículo real...', 'info');
      
      const veiculoReal = {
        placa: "ABC-1" + Math.floor(Math.random() * 1000),
        tipo: Math.random() > 0.5 ? "carro" : "moto",
        valor: 10 + Math.floor(Math.random() * 20),
        formaPagamento: Math.random() > 0.5 ? "dinheiro" : "pix",
        pago: Math.random() > 0.5,
        entrada: new Date().toISOString()
      };
      
      addLog(`📦 Veículo: ${veiculoReal.placa} (${veiculoReal.tipo}) - R$ ${veiculoReal.valor}`, 'info');
      
      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(veiculoReal)
        });
        
        addLog(`📨 Status: ${response.status} ${response.statusText}`,
               response.ok ? 'success' : 'error');
        
        if (response.ok) {
          const data = await response.json();
          addLog(`✅ SUCESSO! Veículo ${veiculoReal.placa} adicionado!`, 'success');
          
          // Testar GET para ver se aparece na lista
          setTimeout(testarGET, 1000);
        } else {
          const erro = await response.text();
          addLog(`❌ ERRO: ${erro}`, 'error');
        }
      } catch (error) {
        addLog(`💥 ERRO GRAVE: ${error.message}`, 'error');
      }
    }

    // Iniciar
    addLog('🟢 Sistema pronto para testes!', 'success');
    addLog('Clique nos botões para testar o backend', 'info');
  </script>
</body>
</html>
