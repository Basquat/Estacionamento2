<!DOCTYPE html>
<html lang="pt-br" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Estaciona+ • Controle de Placas</title>
  <!-- Fonte -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

  <!-- Tailwind via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'ui-sans-serif', 'system-ui'] },
          boxShadow: {
            'glow': '0 0 0 4px rgb(59 130 246 / 20%)',
          },
          keyframes: {
            fadeIn: { '0%': { opacity: 0, transform:'translateY(8px)' }, '100%': { opacity: 1, transform:'translateY(0)'} },
            pop: { '0%': { transform:'scale(0.95)', opacity:0 }, '100%': { transform:'scale(1)', opacity:1 }},
            blink: { '0%,100%':{opacity:.4}, '50%':{opacity:1} }
          },
          animation: {
            fadeIn: 'fadeIn .35s ease-out',
            pop: 'pop .2s ease-out',
            blink: 'blink 1.2s ease-in-out infinite'
          }
        }
      }
    }
  </script>

  <!-- Ícones -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

  <!-- React 18 + Babel (sem build) -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <meta name="color-scheme" content="light dark" />
  <style>
    ::-webkit-scrollbar{ width:10px; height:10px }
    ::-webkit-scrollbar-thumb{ background:rgba(100,100,100,.25); border-radius:999px }
    ::-webkit-scrollbar-track{ background:transparent }
    
    .loading { opacity: 0.6; pointer-events: none; }
  </style>
</head>
<body class="bg-slate-50 text-slate-900 dark:bg-slate-950 dark:text-slate-100 selection:bg-blue-200 dark:selection:bg-blue-800/60">
  <header class="sticky top-0 z-40 backdrop-blur supports-[backdrop-filter]:bg-white/70 dark:supports-[backdrop-filter]:bg-slate-900/60 border-b border-slate-200/60 dark:border-slate-800">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 py-3 flex items-center gap-3">
      <div class="flex items-center gap-2 font-extrabold tracking-tight text-xl">
        <span class="inline-flex size-8 items-center justify-center rounded-2xl bg-blue-600 text-white shadow-glow animate-pop">
          <i data-lucide="parking-square" class="w-5 h-5"></i>
        </span>
        <a href="#inicio" class="hover:opacity-80 transition">Estaciona+</a>
      </div>
      <nav class="ml-auto hidden sm:flex items-center gap-2 text-sm">
        <a href="#inicio" class="px-3 py-1.5 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800 transition">Início</a>
        <a href="#placas" class="px-3 py-1.5 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800 transition">Placas</a>
        <a href="#relatorios" class="px-3 py-1.5 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800 transition">Relatórios</a>
        <a href="#config" class="px-3 py-1.5 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800 transition">Config</a>
      </nav>
      <button id="themeToggle" class="ml-2 inline-flex items-center gap-2 px-3 py-1.5 rounded-xl border border-slate-200 dark:border-slate-800 hover:bg-slate-100 dark:hover:bg-slate-800 transition text-sm">
        <i data-lucide="sun" class="w-4 h-4 block dark:hidden"></i>
        <i data-lucide="moon" class="w-4 h-4 hidden dark:block"></i>
        <span class="hidden sm:inline">Tema</span>
      </button>
    </div>
  </header>

  <main id="root" class="max-w-6xl mx-auto px-4 sm:px-6 py-6"></main>

  <footer class="sticky bottom-0 z-40 md:hidden backdrop-blur supports-[backdrop-filter]:bg-white/70 dark:supports-[backdrop-filter]:bg-slate-900/60 border-t border-slate-200/60 dark:border-slate-800">
    <div class="max-w-6xl mx-auto px-4 py-2 flex items-center justify-around text-xs">
      <a href="#inicio" class="flex flex-col items-center gap-1 p-2 rounded-xl active:scale-95 transition"><i data-lucide="home" class="w-5 h-5"></i>Início</a>
      <a href="#placas" class="flex flex-col items-center gap-1 p-2 rounded-xl active:scale-95 transition"><i data-lucide="list-checks" class="w-5 h-5"></i>Placas</a>
      <a href="#relatorios" class="flex flex-col items-center gap-1 p-2 rounded-xl active:scale-95 transition"><i data-lucide="pie-chart" class="w-5 h-5"></i>Relatórios</a>
      <a href="#config" class="flex flex-col items-center gap-1 p-2 rounded-xl active:scale-95 transition"><i data-lucide="settings" class="w-5 h-5"></i>Config</a>
    </div>
  </footer>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    // --------- CONFIGURAÇÃO DA API ---------
    const API_BASE_URL = 'https://estacionamento2-production.up.railway.app/api/veiculos';

    // --------- Serviço de API ---------
    const apiService = {
      async getAll() {
        const response = await fetch(API_BASE_URL);
        if (!response.ok) throw new Error('Erro ao carregar veículos');
        return await response.json();
      },

      async create(veiculo) {
        const response = await fetch(API_BASE_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(veiculo)
        });
        if (!response.ok) throw new Error('Erro ao criar veículo');
        return await response.json();
      },

      async togglePago(id) {
        const response = await fetch(`${API_BASE_URL}/${id}/pago`, {
          method: 'PUT'
        });
        if (!response.ok) throw new Error('Erro ao atualizar pagamento');
        return await response.json();
      },

      async updateValor(id, valor) {
        const response = await fetch(`${API_BASE_URL}/${id}/valor`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ valor })
        });
        if (!response.ok) throw new Error('Erro ao atualizar valor');
        return await response.json();
      },

      async delete(id) {
        const response = await fetch(`${API_BASE_URL}/${id}`, {
          method: 'DELETE'
        });
        if (!response.ok) throw new Error('Erro ao deletar veículo');
      }
    };

    // --------- Utilidades ---------
    function formatBRL(value){
      if(value === '' || value === null || value === undefined) return '';
      const n = Number(value) || 0;
      return n.toLocaleString('pt-BR', { style:'currency', currency:'BRL' });
    }

    function uuid(){
      return crypto?.randomUUID?.() || ('id-' + Math.random().toString(36).slice(2));
    }

    // --------- Componentes ---------
    function StatCard({icon, label, value, sub}){
      return (
        <div className="group p-4 rounded-2xl border border-slate-200 dark:border-slate-800 bg-white/70 dark:bg-slate-900/40 shadow-sm hover:shadow-md transition animate-fadeIn">
          <div className="flex items-center gap-3">
            <span className="inline-flex items-center justify-center w-10 h-10 rounded-xl bg-blue-600/10 text-blue-700 dark:text-blue-300">
              <i data-lucide={icon} className="w-5 h-5"></i>
            </span>
            <div className="flex-1">
              <div className="text-xs uppercase tracking-wider text-slate-500 dark:text-slate-400">{label}</div>
              <div className="text-2xl font-semibold">{value}</div>
              {sub && <div className="text-xs text-slate-500 dark:text-slate-400 mt-1">{sub}</div>}
            </div>
          </div>
        </div>
      )
    }

    function Tabs({tab, setTab}){
      const tabs = [
        {id:'todos', label:'Todos', icon:'list'},
        {id:'carro', label:'Carros', icon:'car'},
        {id:'moto', label:'Motos', icon:'motorcycle'},
      ];
      return (
        <div className="flex w-full overflow-x-auto gap-2 pb-1">
          {tabs.map(t => (
            <button key={t.id}
              onClick={() => setTab(t.id)}
              className={
                'flex items-center gap-2 px-4 py-2 rounded-2xl border transition ' +
                (tab===t.id
                  ? 'bg-blue-600 text-white border-blue-600 shadow-glow'
                  : 'bg-white/70 dark:bg-slate-900/40 border-slate-200 dark:border-slate-800 hover:bg-slate-100 dark:hover:bg-slate-800')
              }>
              <i data-lucide={t.icon} className="w-4 h-4"></i>
              <span>{t.label}</span>
            </button>
          ))}
        </div>
      )
    }

    function AddForm({onAdd, loading}){
      const [placa, setPlaca] = useState('');
      const [tipo, setTipo] = useState('carro');
      const [valor, setValor] = useState('');
      const [pago, setPago] = useState(false);
      const [formaPagamento, setFormaPagamento] = useState('dinheiro');

      async function handleSubmit(e){
        e.preventDefault();
        if(!placa.trim() || loading) return;
        
        const novo = { 
          placa: placa.trim().toUpperCase(), 
          tipo, 
          valor: Number(valor)||0, 
          pago, 
          formaPagamento
        };
        
        await onAdd(novo);
        setPlaca(''); 
        setValor(''); 
        setPago(false); 
        setTipo('carro'); 
        setFormaPagamento('dinheiro');
      }

      return (
        <form onSubmit={handleSubmit} className={`grid gap-3 md:grid-cols-12 items-end p-4 rounded-2xl border border-slate-200 dark:border-slate-800 bg-white/70 dark:bg-slate-900/40 animate-fadeIn ${loading ? 'opacity-50' : ''}`}>
          <div className="md:col-span-3">
            <label className="text-xs text-slate-500 dark:text-slate-400">Placa</label>
            <input 
              value={placa} 
              onChange={e=>setPlaca(e.target.value)} 
              placeholder="ABC-1234"
              disabled={loading}
              className="w-full mt-1 px-3 py-2 rounded-xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 outline-none focus:ring-4 focus:ring-blue-500/20"/>
          </div>
          <div>
            <label className="text-xs text-slate-500 dark:text-slate-400">Tipo</label>
            <select 
              value={tipo} 
              onChange={e=>setTipo(e.target.value)}
              disabled={loading}
              className="w-full mt-1 px-3 py-2 rounded-xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 outline-none focus:ring-4 focus:ring-blue-500/20">
              <option value="carro">Carro</option>
              <option value="moto">Moto</option>
            </select>
          </div>
          <div className="md:col-span-2">
            <label className="text-xs text-slate-500 dark:text-slate-400">Valor (R$)</label>
            <input 
              value={valor} 
              onChange={e=>setValor(e.target.value.replace(',','.'))} 
              type="number" 
              step="0.01" 
              min="0" 
              placeholder="0,00"
              disabled={loading}
              className="w-full mt-1 px-3 py-2 rounded-xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 outline-none focus:ring-4 focus:ring-blue-500/20"/>
          </div>
          <div className="md:col-span-2">
            <label className="text-xs text-slate-500 dark:text-slate-400">Pagamento</label>
            <select 
              value={formaPagamento} 
              onChange={e=>setFormaPagamento(e.target.value)}
              disabled={loading}
              className="w-full mt-1 px-3 py-2 rounded-xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 outline-none focus:ring-4 focus:ring-blue-500/20">
              <option value="dinheiro">Dinheiro</option>
              <option value="pix">Pix</option>
            </select>
          </div>
          <div className="flex items-center gap-2 md:col-span-2">
            <input 
              id="pago" 
              type="checkbox" 
              checked={pago} 
              onChange={e=>setPago(e.target.checked)} 
              disabled={loading}
              className="w-4 h-4 rounded border-slate-300 text-blue-600"/>
            <label htmlFor="pago" className="text-sm">Pago</label>
          </div>
          <div className="md:col-span-2 flex justify-end">
            <button 
              disabled={loading}
              className="w-full md:w-auto inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-blue-600 text-white hover:brightness-110 active:scale-95 transition disabled:opacity-50">
              <i data-lucide={loading ? "loader" : "plus"} className={`w-4 h-4 ${loading ? 'animate-spin' : ''}`}></i>
              {loading ? 'Adicionando...' : 'Adicionar'}
            </button>
          </div>
        </form>
      )
    }

    function Row({item, onTogglePago, onUpdateValor, onDelete, loading}){
      const [editing, setEditing] = useState(false);
      const [tempValor, setTempValor] = useState(item.valor);

      async function save(){ 
        await onUpdateValor(item.id, Number(tempValor)||0); 
        setEditing(false); 
      }

      return (
        <div className={`p-3 rounded-2xl border border-slate-200 dark:border-slate-800 bg-white/70 dark:bg-slate-900/40 hover:shadow-sm transition animate-fadeIn ${loading ? 'opacity-50' : ''}`}>
          <div className="flex items-center gap-3">
            <span className={'inline-flex items-center justify-center w-10 h-10 rounded-xl '+(item.tipo==='carro' ? 'bg-emerald-500/10 text-emerald-600 dark:text-emerald-300' : 'bg-fuchsia-500/10 text-fuchsia-600 dark:text-fuchsia-300')}>
              <i data-lucide={item.tipo==='carro'?'car':'motorcycle'} className="w-5 h-5"></i>
            </span>
            <div className="flex-1 min-w-0">
              <div className="font-semibold tracking-wide">{item.placa}</div>
              <div className="text-xs text-slate-500 dark:text-slate-400">
                {new Date(item.entrada).toLocaleString('pt-BR')}
                {item.formaPagamento && ` • ${item.formaPagamento === 'pix' ? 'Pix' : 'Dinheiro'}`}
              </div>
            </div>

            {!editing ? (
              <div className="text-right">
                <div className={"text-sm font-medium "+(item.pago?'text-emerald-600 dark:text-emerald-400':'text-amber-600 dark:text-amber-400')}>
                  {item.pago ? 'Pago' : 'Pendente'}
                </div>
                <div className="text-lg font-semibold">{formatBRL(item.valor)}</div>
                {item.pago && item.formaPagamento && (
                  <div className="text-xs text-slate-500 dark:text-slate-400">
                    {item.formaPagamento === 'pix' ? '💳 Pix' : '💵 Dinheiro'}
                  </div>
                )}
              </div>
            ) : (
              <div className="flex items-center gap-2">
                <input 
                  type="number" 
                  step="0.01" 
                  min="0" 
                  value={tempValor} 
                  onChange={e=>setTempValor(e.target.value)} 
                  className="w-28 px-3 py-2 rounded-xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900" />
                <button 
                  onClick={save} 
                  disabled={loading}
                  className="px-3 py-2 rounded-xl bg-emerald-600 text-white hover:brightness-110 disabled:opacity-50">
                  {loading ? '...' : 'Salvar'}
                </button>
              </div>
            )}

            <div className="flex items-center gap-1 ml-2">
              <button 
                onClick={()=>onTogglePago(item.id)} 
                disabled={loading}
                title="Alternar pago" 
                className="p-2 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800 transition disabled:opacity-50">
                <i data-lucide="badge-check" className="w-5 h-5"></i>
              </button>
              <button 
                onClick={()=>setEditing(v=>!v)} 
                disabled={loading}
                title="Editar valor" 
                className="p-2 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800 transition disabled:opacity-50">
                <i data-lucide="pencil" className="w-5 h-5"></i>
              </button>
              <button 
                onClick={()=>onDelete(item.id)} 
                disabled={loading}
                title="Remover" 
                className="p-2 rounded-xl hover:bg-red-50 dark:hover:bg-red-900/20 text-red-600 disabled:opacity-50">
                <i data-lucide="trash-2" className="w-5 h-5"></i>
              </button>
            </div>
          </div>
        </div>
      )
    }

    function List({items, search, tab, loading, ...handlers}){
      const filtered = items.filter(it =>
        (tab==='todos' || it.tipo===tab) &&
        it.placa.toLowerCase().includes(search.toLowerCase())
      );

      return (
        <div className="grid gap-3">
          {filtered.length === 0 && !loading && (
            <div className="p-6 text-center rounded-2xl border border-slate-200 dark:border-slate-800 bg-white/60 dark:bg-slate-900/40 animate-fadeIn">
              <div className="mx-auto w-10 h-10 rounded-full bg-slate-200 dark:bg-slate-800 mb-2 flex items-center justify-center">
                <i data-lucide="search-x" className="w-5 h-5"></i>
              </div>
              <p className="text-sm text-slate-500 dark:text-slate-400">Nada por aqui… tente outra placa, ou adicione um veículo.</p>
            </div>
          )}
          
          {loading && filtered.length === 0 && (
            <div className="p-6 text-center rounded-2xl border border-slate-200 dark:border-slate-800 bg-white/60 dark:bg-slate-900/40">
              <div className="mx-auto w-10 h-10 rounded-full bg-slate-200 dark:bg-slate-800 mb-2 flex items-center justify-center">
                <i data-lucide="loader" className="w-5 h-5 animate-spin"></i>
              </div>
              <p className="text-sm text-slate-500 dark:text-slate-400">Carregando veículos...</p>
            </div>
          )}

          {filtered.map(item => (
            <Row key={item.id} item={item} loading={loading} {...handlers} />
          ))}
        </div>
      )
    }

    function Section({id, title, subtitle, children, action}){
      return (
        <section id={id} className="scroll-mt-24 py-6">
          <div className="flex items-end justify-between mb-3">
            <div>
              <h2 className="text-xl sm:text-2xl font-bold tracking-tight">{title}</h2>
              {subtitle && <p className="text-sm text-slate-500 dark:text-slate-400">{subtitle}</p>}
            </div>
            {action}
          </div>
          {children}
        </section>
      )
    }

    function useTheme(){
      const [theme, setTheme] = useState('light');
      useEffect(()=>{
        const root = document.documentElement;
        if(theme==='dark') root.classList.add('dark'); 
        else root.classList.remove('dark');
      }, [theme]);
      return [theme, setTheme];
    }

    function App(){
      const [theme, setTheme] = useTheme();
      const [items, setItems] = useState([]);
      const [tab, setTab] = useState('todos');
      const [search, setSearch] = useState('');
      const [loading, setLoading] = useState(false);
      const [apiStatus, setApiStatus] = useState('checking');

      // Carregar dados da API
      useEffect(() => {
        loadData();
      }, []);

      async function loadData() {
        setLoading(true);
        try {
          const data = await apiService.getAll();
          setItems(data);
          
